# LLM Agent é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäº FastAPI çš„ LLM Agent é¡¹ç›®ï¼Œæ”¯æŒå¤šç§ç±»å‹çš„ AI ä»£ç†è¿›è¡Œå¯¹è¯äº¤äº’ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– å¤š Agent æ”¯æŒ

- **Chat Agent**: é€šç”¨å¯¹è¯ä»£ç†ï¼Œæ”¯æŒå¤šè½®å¯¹è¯è®°å¿†
- **Router Agent**: æ–‡æ¡£å¤„ç†ä»£ç†ï¼Œæ”¯æŒæ–‡ä»¶æ€»ç»“ã€ç¿»è¯‘ã€PPT ç”Ÿæˆç­‰åŠŸèƒ½

### ğŸ”’ ä¼šè¯éš”ç¦»

- ä¸åŒç±»å‹çš„ Agent ä½¿ç”¨ç‹¬ç«‹çš„ä¼šè¯å­˜å‚¨ç©ºé—´
- å³ä½¿ä½¿ç”¨ç›¸åŒçš„ `conversation_id`ï¼Œä¸åŒ Agent çš„å¯¹è¯å†å²ä¹Ÿä¸ä¼šç›¸äº’å¹²æ‰°
- æ”¯æŒä¼šè¯ç»Ÿè®¡å’Œç®¡ç†åŠŸèƒ½

## API ç«¯ç‚¹

### Chat Agent

- `POST /chat` - ä¸ Chat Agent è¿›è¡Œå¯¹è¯

### Router Agent

- `POST /router` - ä¸ Router Agent è¿›è¡Œäº¤äº’

### ç®¡ç†åŠŸèƒ½

- `GET /stats` - è·å–å„ Agent ç±»å‹çš„ä¼šè¯ç»Ÿè®¡ä¿¡æ¯

## ä¼šè¯éš”ç¦»æœºåˆ¶

### é—®é¢˜èƒŒæ™¯

åœ¨ä¹‹å‰çš„å®ç°ä¸­ï¼Œ`chat_agent` å’Œ `router_agent` å…±äº«åŒä¸€ä¸ªä¼šè¯å­˜å‚¨ç©ºé—´ï¼Œå½“ä½¿ç”¨ç›¸åŒçš„ `conversation_id` æ—¶ä¼šå¯¼è‡´å¯¹è¯å†å²æ··æ·†ã€‚

### è§£å†³æ–¹æ¡ˆ

1. **åˆ†å±‚å­˜å‚¨ç»“æ„**: ä½¿ç”¨åµŒå¥—å­—å…¸ç»“æ„ï¼ŒæŒ‰ Agent ç±»å‹éš”ç¦»ä¼šè¯çŠ¶æ€
2. **Agent ç±»å‹æ ‡è¯†**: æ¯ä¸ª Agent ä½¿ç”¨ç‰¹å®šçš„ç±»å‹æ ‡è¯†ç¬¦ï¼ˆ"chat"ã€"router"ï¼‰
3. **ç‹¬ç«‹çŠ¶æ€ç®¡ç†**: ä¸åŒç±»å‹çš„ Agent æ‹¥æœ‰å®Œå…¨ç‹¬ç«‹çš„ä¼šè¯çŠ¶æ€

### å­˜å‚¨ç»“æ„

```python
conversation_states = {
    "chat": {
        "conversation_id_1": {"messages": [...]},
        "conversation_id_2": {"messages": [...]}
    },
    "router": {
        "conversation_id_1": {"messages": [...], "input_file_link": "...", ...},
        "conversation_id_3": {"messages": [...], "operation_type": "...", ...}
    }
}
```

## å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
python test_conversation_isolation.py
```

### æ·»åŠ æ–°çš„ Agent ç±»å‹

1. åœ¨ `conversation_service.py` ä¸­ä¸ºæ–° Agent æŒ‡å®šå”¯ä¸€çš„ `agent_type`
2. åœ¨ Agent å¤„ç†å‡½æ•°ä¸­ä¼ å…¥å¯¹åº”çš„ `agent_type` å‚æ•°
3. ç¡®ä¿æ–° Agent çš„çŠ¶æ€ç»“æ„ä¸ç°æœ‰ Agent å…¼å®¹

## æŠ€æœ¯æ ˆ

- **FastAPI**: Web æ¡†æ¶
- **LangChain**: LLM é›†æˆ
- **LangGraph**: å·¥ä½œæµç¼–æ’
- **Pydantic**: æ•°æ®éªŒè¯
- **asyncio**: å¼‚æ­¥ç¼–ç¨‹

## é¡¹ç›®ç»“æ„

```
app/
â”œâ”€â”€ agents/           # Agent å®ç°
â”‚   â”œâ”€â”€ chat_agent/   # é€šç”¨å¯¹è¯ Agent
â”‚   â””â”€â”€ router_agent/ # æ–‡æ¡£å¤„ç† Agent
â”œâ”€â”€ api/              # API ç«¯ç‚¹
â”œâ”€â”€ services/         # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ llms/             # LLM é…ç½®
â””â”€â”€ core/             # æ ¸å¿ƒåŠŸèƒ½
```
